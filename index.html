<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>NutriFind â€“ Recipe Nutrition Calculator & Macro Analyzer</title>
<meta name="description" content="NutriFind lets you calculate recipe calories, macros and nutrition facts instantly. Add ingredients, analyze portions, visualize fat-carb-protein chart and export results.">
<meta name="keywords" content="nutrition calculator, macro calculator, recipe calories, nutrifind, calorie counter, food nutrition">
<meta name="author" content="NutriFind">

<link rel="icon" href="https://em-content.zobj.net/source/apple/391/salad_1f957.png">

<style>
:root {
  --primary:#0a7c36;
  --bg:#f5f7f8;
  --card:#ffffff;
  --text:#222;
}

body.dark {
  --bg:#111;
  --card:#222;
  --text:#eee;
  --primary:#6bff94;
}

body {
  font-family: Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:0;
}

header {
  text-align:center;
  padding:25px 15px 10px;
}

.container {
  max-width:900px;
  margin:auto;
  padding:10px 20px 40px;
}

/* Ingredient row */
.ingredient-row {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:10px;
}

.ingredient-row input, .ingredient-row select {
  flex:1;
  min-width:120px;
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
}

.remove-btn {
  background:#ff4d4d;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:0 10px;
  font-size:18px;
  cursor:pointer;
}

/* Buttons */
button {
  cursor:pointer;
}

.add-btn,
.calc-btn,
.copy-btn,
.export-btn {
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  margin-top:10px;
}

.copy-btn { background:#222; }
.export-btn{ background:#0066dd; }

/* Card layout */
.results-wrapper {
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  margin-top:25px;
}

.card {
  background:var(--card);
  border-radius:12px;
  padding:20px;
  flex:1;
  min-width:260px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

/* Table */
table {
  width:100%;
  border-collapse:collapse;
}
table td {
  padding:6px 0;
  border-bottom:1px solid #ccc;
}
table td:last-child {
  text-align:right;
}
table tr:first-child td {
  font-weight:bold;
  font-size:18px;
}

/* Dark mode floating toggle */
.dark-toggle {
  position:fixed;
  bottom:20px;
  right:20px;
  font-size:30px;
  background:#fff;
  border-radius:50%;
  width:45px;
  height:45px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 3px 7px rgba(0,0,0,0.2);
}

/* Mobile fixes */
@media(max-width:600px) {
  .ingredient-row {
    flex-direction:column;
  }
}
</style>
</head>
<body>

<header>
  <h1>ðŸ¥— NutriFind Recipe Calculator</h1>
  <p>Easily calculate calories, macros, and nutrition for full meals.</p>
</header>

<div class="container">

  <div id="ingredientsContainer"></div>
  <button class="add-btn" onclick="addIngredient()">+ Add Ingredient</button>
  <button class="calc-btn" onclick="calculateRecipe()">Calculate Nutrition</button>

  <!-- Results -->
  <div id="resultsSection" style="display:none;">
    
    <div class="results-wrapper">
      
      <div class="card">
        <table id="nutritionTable"></table>
      </div>

      <div class="card">
        <h3 style="margin-top:0;">Macro Breakdown</h3>
        <canvas id="macroChart"></canvas>
      </div>

    </div>

    <div style="margin-top:15px; display:flex; gap:10px;">
      <button class="copy-btn" onclick="copyTable()">Copy Data</button>
      <button class="export-btn" onclick="exportScreenshot()">Save Image</button>
    </div>

  </div>

</div>

<footer style="text-align:center; padding:15px; font-size:13px;">NutriFind Â© 2025</footer>

<div class="dark-toggle" onclick="toggleDarkMode()">ðŸŒ™</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
let savedIngredients = JSON.parse(localStorage.getItem("nfIngredients")) || [];

function ingredientRowHTML(food="", amount=100, unit="g"){
  return `
    <div class="ingredient-row">
      <input type="text" class="food" placeholder="Ingredient" value="${food}">
      <input type="number" class="amount" value="${amount}">
      <select class="unit">
        <option value="g" ${unit==="g"?"selected":""}>g</option>
        <option value="cup" ${unit==="cup"?"selected":""}>cup</option>
        <option value="tbsp" ${unit==="tbsp"?"selected":""}>tbsp</option>
        <option value="tsp" ${unit==="tsp"?"selected":""}>tsp</option>
        <option value="piece" ${unit==="piece"?"selected":""}>piece</option>
      </select>
      <button class="remove-btn" onclick="removeIngredient(this)">âœ•</button>
    </div>
  `;
}

function loadIngredients(){
  if(savedIngredients.length){
    savedIngredients.forEach(ing => {
      document.getElementById('ingredientsContainer').insertAdjacentHTML("beforeend", ingredientRowHTML(ing.food, ing.amount, ing.unit));
    });
  } else {
    addIngredient();
  }
}

function saveIngredients(){
  const rows = [...document.querySelectorAll(".ingredient-row")];
  savedIngredients = rows.map(r => ({
    food:r.querySelector(".food").value,
    amount:r.querySelector(".amount").value,
    unit:r.querySelector(".unit").value
  }));
  localStorage.setItem("nfIngredients", JSON.stringify(savedIngredients));
}

function addIngredient(){
  document.getElementById("ingredientsContainer").insertAdjacentHTML("beforeend", ingredientRowHTML());
  saveIngredients();
}

function removeIngredient(btn){
  btn.parentElement.remove();
  saveIngredients();
}

loadIngredients();

/* Fetch API */
async function getNutrition(query){
  const res = await fetch(`/api/nutrition?query=${encodeURIComponent(query)}`);
  return await res.json();
}

/* Macro Chart */
let chartInstance = null;

async function calculateRecipe(){
  saveIngredients();

  const rows = document.querySelectorAll(".ingredient-row");
  let totals = { cal:0, fat:0, carb:0, protein:0 };

  for(const row of rows){
    const food = row.querySelector(".food").value.trim();
    const amt = row.querySelector(".amount").value;
    const unit = row.querySelector(".unit").value;
    if(!food) continue;

    const query = `${amt}${unit} ${food}`;
    const data = await getNutrition(query);

    if(!data.items || !data.items.length) continue;
    const item = data.items[0];

    totals.cal += item.calories || 0;
    totals.fat += item.fat_total_g || 0;
    totals.carb += item.carbohydrates_total_g || 0;
    totals.protein += item.protein_g || 0;
  }

  // Update table
  document.getElementById("nutritionTable").innerHTML = `
    <tr><td>Total Calories</td><td>${Math.round(totals.cal)}</td></tr>
    <tr><td>Fat</td><td>${totals.fat.toFixed(1)} g</td></tr>
    <tr><td>Carbs</td><td>${totals.carb.toFixed(1)} g</td></tr>
    <tr><td>Protein</td><td>${totals.protein.toFixed(1)} g</td></tr>
  `;

  document.getElementById("resultsSection").style.display="block";

  renderChart(totals);
}

/* Chart.js rendering */
function renderChart(t){
  const ctx = document.getElementById("macroChart");

  if(chartInstance) chartInstance.destroy();

  chartInstance = new Chart(ctx, {
    type:"doughnut",
    data:{
      labels:["Fat","Carbs","Protein"],
      datasets:[{
        data:[t.fat, t.carb, t.protein],
        backgroundColor:["#ffb6b6","#a8e6cf","#ffd3b6"],
        borderWidth:2,
        borderColor:"#fff"
      }]
    },
    options:{
      responsive:true,
      cutout:"60%"
    }
  });
}

/* Copy table */
function copyTable(){
  navigator.clipboard.writeText(document.getElementById("nutritionTable").innerText);
  alert("Copied to clipboard!");
}

/* Export Image */
function exportScreenshot(){
  html2canvas(document.querySelector(".results-wrapper")).then(canvas=>{
    const link=document.createElement("a");
    link.download="nutrition.png";
    link.href=canvas.toDataURL();
    link.click();
  });
}

/* Dark mode toggle */
function toggleDarkMode(){
  document.body.classList.toggle("dark");
}
</script>

</body>
</html>
