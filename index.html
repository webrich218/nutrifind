<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Food Facts Finder | Nutrition Facts & Calories</title>
  <meta name="description" content="Instantly search nutrition facts, calories, macros, and % Daily Values for any food. Copy or share your results easily.">
  <meta name="theme-color" content="#009578">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¥—</text></svg>">

  <style>
    :root {
      --bg: #f9fafb;
      --text: #111;
      --accent: #009578;
      --border: #ddd;
      --card-bg: #fff;
    }

    body.dark {
      --bg: #111827;
      --text: #f3f4f6;
      --accent: #22c55e;
      --border: #374151;
      --card-bg: #1f2937;
    }

    body {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px 100px;
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
    }

    h1 {
      font-size: 1.9rem;
      margin-bottom: 6px;
      text-align: center;
      font-weight: 700;
    }

    p {
      color: #555;
      text-align: center;
      margin-bottom: 25px;
      line-height: 1.4;
      max-width: 480px;
    }

    body.dark p { color: #d1d5db; }

    /* Sticky theme toggle button */
    .theme-toggle {
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 25px;
      padding: 10px 18px;
      font-size: 1rem;
      cursor: pointer;
      color: var(--text);
      transition: 0.3s ease;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      z-index: 10;
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: #fff;
    }

    input {
      width: 100%;
      max-width: 420px;
      padding: 14px 16px;
      border: 1px solid #ccc;
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 25px;
      outline: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: 0.2s ease;
    }

    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,149,120,0.15);
    }

    body.dark input {
      background: #374151;
      border-color: #4b5563;
      color: #f9fafb;
    }

    .nutrition-facts {
      background: var(--card-bg);
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      padding: 20px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.08);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .nutrition-facts h2 {
      font-size: 1.5rem;
      margin-bottom: 8px;
      font-weight: 800;
      text-align: center;
      border-bottom: 4px solid var(--accent);
      padding-bottom: 6px;
    }

    .food-title {
      font-weight: 600;
      margin-top: 10px;
      text-align: center;
      color: var(--text);
    }

    .calories {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 1.7rem;
      font-weight: 800;
      margin: 12px 0;
    }

    .nutrient {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      margin: 6px 0;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border);
    }

    .nutrient span:last-child {
      text-align: right;
      color: var(--text);
    }

    .dv {
      font-size: 0.8rem;
      color: var(--accent);
      margin-left: 4px;
      font-weight: 600;
    }

    .footer {
      font-size: 0.75rem;
      color: #888;
      margin-top: 15px;
      border-top: 2px solid var(--border);
      padding-top: 8px;
      line-height: 1.3;
      text-align: center;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 18px;
    }

    .btn {
      flex: 1;
      padding: 10px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: #fff;
      font-weight: 600;
      font-size: 0.9rem;
      transition: 0.2s ease;
    }

    .btn-copy { background-color: var(--accent); }
    .btn-share { background-color: #444; }
    .btn:hover { opacity: 0.9; transform: scale(1.02); }

    .loading {
      color: #555;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    body.dark .loading { color: #ccc; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 500px) {
      body { padding: 24px 16px 100px; }
      h1 { font-size: 1.6rem; }
      input { font-size: 0.95rem; }
      .nutrition-facts { padding: 16px; }
      .calories { font-size: 1.4rem; }
      .nutrient { font-size: 0.9rem; }
    }
  </style>
</head>

<body>
  <h1>ðŸ¥— Food Facts Finder</h1>
  <p>Search any food to view, copy, or share its complete nutrition facts and % Daily Values.</p>

  <input type="text" id="search" placeholder="e.g. apple, chicken breast, fried rice" />
  <div class="loading" id="loading" style="display:none;">Fetching data...</div>
  <div class="nutrition-facts" id="result"></div>

  <!-- Sticky dark mode button -->
  <button class="theme-toggle" id="themeToggle">ðŸŒ™ Dark</button>

  <script>
    // Theme toggle logic
    const themeToggle = document.getElementById("themeToggle");
    const userPref = localStorage.getItem("theme");
    if (userPref === "dark" || (!userPref && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      document.body.classList.add("dark");
      themeToggle.textContent = "â˜€ï¸ Light";
    }

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      themeToggle.textContent = isDark ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    const searchInput = document.getElementById("search");
    const resultBox = document.getElementById("result");
    const loading = document.getElementById("loading");

    async function fetchNutrition(foodName) {
      const url = `/.netlify/functions/fetchNutrition?query=${encodeURIComponent(foodName)}`;
      try {
        loading.style.display = "block";
        resultBox.style.display = "none";

        const response = await fetch(url);
        const data = await response.json();

        if (data.items && data.items.length > 0) {
          const food = data.items[0];
          showResult(food);
        } else {
          resultBox.innerHTML = "<p>No results found. Try a different food.</p>";
          resultBox.style.display = "block";
        }
      } catch (error) {
        resultBox.innerHTML = "<p>Error fetching data. Please try again.</p>";
        resultBox.style.display = "block";
      } finally {
        loading.style.display = "none";
      }
    }

    function showResult(food) {
      resultBox.style.display = "block";
      const dv = {
        fat: (food.fat_total_g / 78) * 100,
        cholesterol: (food.cholesterol_mg / 300) * 100,
        sodium: (food.sodium_mg / 2300) * 100,
        carbs: (food.carbohydrates_total_g / 275) * 100,
        fiber: (food.fiber_g / 28) * 100,
        protein: (food.protein_g / 50) * 100
      };

      const nutritionText = `
${food.name.toUpperCase()}
Calories: ${food.calories.toFixed(0)} kcal
Total Fat: ${food.fat_total_g.toFixed(1)} g (${dv.fat.toFixed(0)}% DV)
Cholesterol: ${food.cholesterol_mg.toFixed(0)} mg (${dv.cholesterol.toFixed(0)}% DV)
Sodium: ${food.sodium_mg.toFixed(0)} mg (${dv.sodium.toFixed(0)}% DV)
Carbohydrates: ${food.carbohydrates_total_g.toFixed(1)} g (${dv.carbs.toFixed(0)}% DV)
Fiber: ${food.fiber_g.toFixed(1)} g (${dv.fiber.toFixed(0)}% DV)
Sugar: ${food.sugar_g.toFixed(1)} g
Protein: ${food.protein_g.toFixed(1)} g (${dv.protein.toFixed(0)}% DV)
Serving Size: ${food.serving_size_g || 100} g
`;

      resultBox.innerHTML = `
        <h2>Nutrition Facts</h2>
        <div class="food-title">${food.name.toUpperCase()}</div>
        <div class="calories"><span>Calories</span><span>${food.calories.toFixed(0)}</span></div>

        <div class="nutrient"><span>Total Fat</span><span>${food.fat_total_g.toFixed(1)} g <span class="dv">${dv.fat.toFixed(0)}%</span></span></div>
        <div class="nutrient"><span>Cholesterol</span><span>${food.cholesterol_mg.toFixed(0)} mg <span class="dv">${dv.cholesterol.toFixed(0)}%</span></span></div>
        <div class="nutrient"><span>Sodium</span><span>${food.sodium_mg.toFixed(0)} mg <span class="dv">${dv.sodium.toFixed(0)}%</span></span></div>
        <div class="nutrient"><span>Total Carbohydrates</span><span>${food.carbohydrates_total_g.toFixed(1)} g <span class="dv">${dv.carbs.toFixed(0)}%</span></span></div>
        <div class="nutrient"><span>Dietary Fiber</span><span>${food.fiber_g.toFixed(1)} g <span class="dv">${dv.fiber.toFixed(0)}%</span></span></div>
        <div class="nutrient"><span>Total Sugars</span><span>${food.sugar_g.toFixed(1)} g</span></div>
        <div class="nutrient"><span>Protein</span><span>${food.protein_g.toFixed(1)} g <span class="dv">${dv.protein.toFixed(0)}%</span></span></div>

        <div class="footer">
          *Serving size: ${food.serving_size_g ? food.serving_size_g + " g" : "100 g"}<br>
          *Percent Daily Values (%DV) are based on a 2,000 calorie diet.
        </div>

        <div class="buttons">
          <button id="copyBtn" class="btn btn-copy">ðŸ“‹ Copy</button>
          <button id="shareBtn" class="btn btn-share">ðŸ”— Share</button>
        </div>
      `;

      document.getElementById("copyBtn").onclick = () => {
        navigator.clipboard.writeText(nutritionText);
        alert("Nutrition facts copied! You can paste them into Lose It or anywhere else.");
      };

      document.getElementById("shareBtn").onclick = async () => {
        const shareData = { title: "Food Facts Finder", text: nutritionText, url: window.location.href };
        if (navigator.share) await navigator.share(shareData);
        else alert("Sharing not supported on this device. You can copy instead.");
      };
    }

    let typingTimer;
    searchInput.addEventListener("input", () => {
      clearTimeout(typingTimer);
      const query = searchInput.value.trim();
      if (query.length > 2) typingTimer = setTimeout(() => fetchNutrition(query), 600);
    });
  </script>
</body>
</html>
